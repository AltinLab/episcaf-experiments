process {
    withLabel: af3_process_local {
        executor = 'local'
    }
}

profiles {
    gemini {
        params {
            af3_model_dir = "/ref_genomes/alphafold/alphafold3/models"
            af3_db_dir = "/ref_genomes/alphafold/alphafold3/"
            msa_cache_dir = "/tgen_labs/altin/alphafold3/msa"
        }

        process {
            withLabel: alphafold3_inference {
                executor = 'slurm'
                queue = 'gpu-a100'
                cpus = '8'
                memory = '64GB'
                clusterOptions = '--nodes=1 --ntasks=1 --gres=gpu:1 --time=2:00:00'
                container = '/tgen_labs/altin/alphafold3/containers/alphafold_3.0.1.sif'
                containerOptions = '--nv -B /scratch,/tgen_labs,/ref_genomes --cleanenv'
                beforeScript = 'module load singularity'
            }

            withLabel: alphafold3_msa {
                executor = 'slurm'
                queue = 'compute'
                cpus = '8'
                clusterOptions = '--nodes=1 --ntasks=1 --time=24:00:00'
                container = '/tgen_labs/altin/alphafold3/containers/alphafold_3.0.1.sif'
                containerOptions = '--nv -B /scratch,/tgen_labs,/ref_genomes --cleanenv'
                beforeScript = 'module load singularity && export SINGULARITYENV_TMPDIR=/scratch/$USER/tmp'
            }

        }

        singularity {
            enabled = true
        }

    }
}